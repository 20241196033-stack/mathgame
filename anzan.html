<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }

    .shop-1 {
      width: 5cm;
      height: 5cm;
      background-image: url("./coinbox.png");
      background-size: cover;
      background-repeat: no-repeat;
      display: inline-block;
      margin: 10px auto;
      border: 2px solid #444;
      border-radius: 10px;
    }

    .indo {
      display: none;
      margin-top: 20px;
    }

    #janken-screen {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>

<body>

  <h1>暗算ゲーム</h1>

  <!-- 通常ゲーム -->
  <div id="game-screen">
    <p id="question"></p>
    <button id="change">ショップ</button>
    <br><br>
    <input type="number" id="answer" placeholder="答えを入力">
    <button onclick="checkAnswer()">回答</button>
    <p id="result"></p>
    <button id="india">地獄のインド式掛け算</button>
    <p id="mamegame"></p>
    <a href="./kuku.html">九九表</a>
  </div>

  <!-- ランダムじゃんけん -->
  <div id="janken-screen">
    <h2>突然じゃんけん！</h2>
    <button class="hand" data-hand="グー">グー</button>
    <button class="hand" data-hand="チョキ">チョキ</button>
    <button class="hand" data-hand="パー">パー</button>
    <p>一回だけ選んでください</p>
    <p id="janken-result"></p>
    <button id="janken-back">戻る</button>
  </div>

  <!-- ショップ -->
  <div id="shop-screen" style="display:none;">
    <h2>ショップ</h2>
    <p>ここでアイテムを買えるよ！</p>

    <div class="shop-1"></div>

    <button id="kotae">２コイン追加ボックス・・・7コイン</button>

    <div id="kazu">コイン数・・0枚</div>
    <p id="mame"></p>

    <br>
    <button id="back">ゲームに戻る</button>
  </div>

  <!-- インド式 -->
  <div class="indo" id="indo-screen">
    <p id="question2"></p>
    <input type="number" id="answer2" placeholder="答えを入力">
    <button onclick="checkAnswer2()">回答</button>
    <p id="result2"></p>
    <button id="back2">戻る</button>
    
  </div>

  <script>
    let a, b, c, d;

    const mame = document.getElementById("mame");
    const mamegame = document.getElementById("mamegame");
    mamegame.textContent =
    mame.textContent = "数学豆知識：円周率は3.14159265358979323846264だよ！";

    let coin = Number(localStorage.getItem("coin")) || 0;

    function newQuestion() {
      a = Math.floor(Math.random() * 25) + 1;
      b = Math.floor(Math.random() * 20) + 1;
      document.getElementById("question").textContent = `${a} x ${b} = ?`;
      document.getElementById("answer").value = "";
      document.getElementById("result").textContent = "";
    }

    function newQuestion2() {
      c = Math.floor(Math.random() * 35) + 1;
      d = Math.floor(Math.random() * 35) + 1;
      document.getElementById("question2").textContent = `${c} x ${d} = ?`;
      document.getElementById("answer2").value = "";
      document.getElementById("result2").textContent = "";
    }

    function checkAnswer() {
      const ans = parseInt(document.getElementById("answer").value);
      if (ans === a * b) {
        document.getElementById("result").textContent = "正解！";
        coin++;
        updateCoin();
      } else {
        document.getElementById("result").textContent = "残念！正解は " + (a * b);
      }
      setTimeout(newQuestion, 1500);
    }

    function checkAnswer2() {
      const ans = parseInt(document.getElementById("answer2").value);
      if (ans === c * d) {
        document.getElementById("result2").textContent = "正解！";
        coin++;
        updateCoin();
      } else {
        document.getElementById("result2").textContent = "残念！正解は " + (c * d);
      }
      setTimeout(newQuestion2, 1500);
    }

    function updateCoin() {
      document.getElementById("kazu").textContent = `コイン数・・${coin}枚`;
      localStorage.setItem("coin", coin);
    }

    const gameScreen = document.getElementById("game-screen");
    const shopScreen = document.getElementById("shop-screen");
    const indoScreen = document.getElementById("indo-screen");
    const jankenScreen = document.getElementById("janken-screen");

    /* ランダムじゃんけん */
    let jankenTimer = null;

    function startRandomJanken() {
      if (jankenTimer !== null) {
        clearTimeout(jankenTimer);
      }

      let time = Math.random() * 9000 + 4000; // 4〜13秒

      jankenTimer = setTimeout(() => {
        gameScreen.style.display = "none";
        jankenScreen.style.display = "block";
      }, time);
    }

    /* じゃんけん処理 */
    const hands = ["グー", "チョキ", "パー"];

    document.querySelectorAll(".hand").forEach(btn => {
      btn.addEventListener("click", () => {
        let player = btn.dataset.hand;
        let cpu = hands[Math.floor(Math.random() * 3)];

        let result = "";
        if (player === cpu) {
          result = "あいこ！";
        } else if (
          (player === "グー" && cpu === "チョキ") ||
          (player === "チョキ" && cpu === "パー") ||
          (player === "パー" && cpu === "グー")
        ) {
          result = "勝ち！ コイン+1";
          coin++;
          updateCoin();
        } else {
          result = "負け…";
        }

        document.getElementById("janken-result").textContent =
          `あなた：${player}　CPU：${cpu} → ${result}`;
      });
    });

    document.getElementById("janken-back").addEventListener("click", () => {
      jankenScreen.style.display = "none";
      gameScreen.style.display = "block";
      startRandomJanken();
    });

    /* ショップ */
    document.getElementById("change").addEventListener("click", () => {
      gameScreen.style.display = "none";
      shopScreen.style.display = "block";
    });

    document.getElementById("back").addEventListener("click", () => {
      shopScreen.style.display = "none";
      gameScreen.style.display = "block";
    });

    document.getElementById("kotae").addEventListener("click", () => {
      if (coin >= 7) {
        coin -= 7;
        coin += 2;
        updateCoin();
        alert("2コイン追加したよ！");
      } else {
        alert("コインが足りないよ！");
      }
    });

    /* インド式 */
    document.getElementById("india").addEventListener("click", () => {
      gameScreen.style.display = "none";
      indoScreen.style.display = "block";
      newQuestion2();
    });

    document.getElementById("back2").addEventListener("click", () => {
      indoScreen.style.display = "none";
      gameScreen.style.display = "block";
    });

    /* ゲーム開始 */
    newQuestion();
    updateCoin();
    startRandomJanken();
  </script>

</body>
</html>
